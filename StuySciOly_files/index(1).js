require=function t(e,i,n){function o(r,a){if(!i[r]){if(!e[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var c=i[r]={exports:{}};e[r][0].call(c.exports,function(t){var i=e[r][1][t];return o(i?i:t)},c,c.exports,t,e,i,n)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(t,e){var i=t("lodash"),n=t("jquery"),o=t("prima/class"),s=o.extend({video_conversion_logged:!1,logging_in_progress:!1,constructor:function(t){this.player=t,this.initialize()},initialize:function(){this.bindListeners()},bindListeners:function(){this.player.on("play",i.bind(this.onPlay,this))},onPlay:function(){this.logConversion({name:"CONVERSION_ACTION_HTML5_VIDEO",extra:{player:this.player.techName,player_version:2}})},logConversion:function(t){if(!this.video_conversion_logged&&!this.logging_in_progress){this.logging_in_progress=!0;var e=n.ajax({url:"/svc/log/conversion",type:"POST",contentType:"application/x-www-form-urlencoded",with_form_key:!0,data:"log="+JSON.stringify(t)});e.done(i.bind(this.onConversionSuccess,this)),e.fail(i.bind(this.onConversionFail,this))}},onConversionSuccess:function(){this.video_conversion_logged=!0,this.logging_in_progress=!1},onConversionFail:function(){this.logging_in_progress=!1}});e.exports=s},{jquery:"HlZQrA",lodash:"K2RcUv","prima/class":26}],2:[function(t,e){"use strict";var i=t("lodash"),n=t("jquery"),o=(t("backbone"),t("prima/component")),s=t("prima/events"),r=t("prima/lib/flags"),a=(t("prima/lib/logger"),t("scrollmonitor")),l=t("./plugins/videojs-with-plugins"),c=t("./crt-logger"),u=o.extend({name:"CrtControl",defaults:{},playerDefaults:{autoplay:!0,state:"stopped",canplay:!1,classNames:["crt-video","crt-skin-default"]},selector:"[data-crt-video]",playerCollection:null,initialize:function(){s.on("CrtControl:newPlayer",i.bind(this.playerFactory,this)),this.playerCollection=[]},playerFactory:function(t,e){i.defer(i.bind(function(){i.each(t,function(t){var i=n(t);i.data("crt-player-attached")||(i.data("crt-player-attached",!0),this.newPlayer(i,e))},this)},this))},newPlayer:function(t,e){var o=t[0],s=i.extend({},this.playerDefaults,e),r=this.shouldAutoplay()&&s.autoplay,a={muted:!0,loop:!0};r&&(e=i.extend({},a,e)),t.addClass(s.classNames.join(" "));var u=this;l(o,e,function(){s.instance=this,s.$el=n(this.player_.el()),s.logger=new c(s.instance),r&&i.bind(u.setupAutoplay,u)(s)}),this.playerCollection.push(s)},shouldAutoplay:function(){return r.bool("autoplay_videos")},setupAutoplay:function(t){t.watcher=a.create(t.instance.el()),this.autoplay(t)},autoplay:function(t){t.watcher.fullyEnterViewport(i.bind(function(){t.autoplay&&this.setQueued(t)},this)),t.watcher.partiallyExitViewport(i.bind(function(){t.autoplay&&this.shouldStop(t)},this)),t.watcher.exitViewport(i.bind(function(){t.autoplay&&this.setStopped(t)},this)),t.$el.on("click.crtAutoPlay",i.bind(this.onClickPlayer,this)),this.bindEvents(t)},bindEvents:function(t){t.instance.on("play",i.bind(function(){this.onPlay(t)},this)),t.instance.on("pause",i.bind(function(){this.onPause(t)},this))},onPlay:function(t){if("playing"!==t.state){var e=this.filterByState("playing");i.each(e,i.bind(function(t){this.setStopped(t)},this)),t.state="playing"}},onPause:function(t){t.state="stopped"},onClickPlayer:function(t){var e=n(t.currentTarget),i=this.getPlayerFromEl(e[0]);i&&(this.setDisabled(i),i.$el.off("click.crtAutoPlay"))},getPlayerFromEl:function(t){return i.filter(this.playerCollection,function(e){return e.$el[0]===t})[0]},filterByState:function(t){return i.filter(this.playerCollection,{state:t})},setPlaying:function(t){t.instance.play()},setQueued:function(t){if(!t.canplay)return t.instance.load(),void t.instance.one("canplaythrough",i.bind(function(){t.canplay=!0,t.watcher.isFullyInViewport&&this.setQueued(t)},this));if(t.watcher.isFullyInViewport){t.state="queued";var e=this.filterByState("playing");e.length&&e[0].watcher.isFullyInViewport||this.playNext()}},setStopped:function(t){t.instance.pause()},shouldStop:function(t){"playing"===t.state&&this.playNext()},playNext:function(){var t=this.filterByState("queued");t.length&&this.setPlaying(t[0])},setDisabled:function(t){this.setStopped(t),t.watcher.destroy(),t.autoplay=!1,t.instance.muted(!1)}});e.exports=u},{"./crt-logger":1,"./plugins/videojs-with-plugins":9,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/component":27,"prima/events":28,"prima/lib/flags":35,"prima/lib/logger":37,scrollmonitor:"y33VHk"}],3:[function(t,e){var i=t("lodash"),n=t("jquery"),o=t("video.js"),s=o.CoreObject.extend({init:function(t,e){this.options=e||{},this.player=t,this.$player=n(this.player.el()),this._selectorCache(),this.initialize.apply(this,arguments)},_selectorCache:function(){this.$$=i.memoize(function(t){return this.$player.find(t)},i.identity),this.$$.remove=i.bind(function(t){delete this.$$.cache[t]},this),this.$$.clear=i.bind(function(){this.$$.cache={}},this)},initialize:function(){}});e.exports=s},{jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],4:[function(t,e){var i=t("video.js"),n=i.BigPlayButton.extend();n.prototype.onClick=function(){this.player_.userActive(!0),this.player_.paused()?this.player_.play():this.player_.pause()},e.exports=n},{"video.js":"AcVSFw"}],5:[function(t,e){var i=t("video.js"),n=i.SeekBar.extend();n.prototype.update=function(){if(this.el_){var t=this.getPercent(),e=this.handle,n=this.bar;isNaN(t)&&(t=0);var o=i.round(100*t,2)+"%";e.el().style.left=o+"%",n.el().style.width=o+"%"}},e.exports=n},{"video.js":"AcVSFw"}],6:[function(t,e){var i=t("jquery"),n=(t("lodash"),t("video.js")),o=t("./base/base-plugin"),s=o.extend({seeking:!1,render:function(){return this.$el=i('<div class="vjs-hover-handle vjs-slider-handle" aria-live="off"><span class="vjs-control-text"></span></div>'),this},afterRender:function(){this.$seekHandle=this.$$(".vjs-seek-handle")},update:function(t){t||(t={}),this.$time_el=this.$time_el||this.$el.find(".vjs-hover-handle-time");var e=t.hoverX||0,i=t.hoverTime||"0:00",o=n.formatTime(i);this.$time_el.html(o),this.$el.css("left",e+"px")}});e.exports=s},{"./base/base-plugin":3,jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],7:[function(t,e){var i=t("jquery"),n=t("video.js"),o=t("./base/base-plugin"),s=o.extend({render:function(){return this.$el=i('<div class="vjs-hover-slider-time" aria-live="off"></div>'),this},update:function(t){t||(t={});var e=t.hoverX||0,i=t.hoverTime||"0:00",o=n.formatTime(i);this.$el.html(o),this.$el.css("left",e+"px")}});e.exports=s},{"./base/base-plugin":3,jquery:"HlZQrA","video.js":"AcVSFw"}],8:[function(t,e){var i=(t("jquery"),t("lodash")),n=t("video.js"),o=t("./base/base-plugin"),s=t("./hover-slider-handle"),r=t("./hover-slider-time"),a=o.extend({elSelector:".vjs-progress-holder",initialize:function(){this.children={},this.$el=this.$$(this.elSelector),this.createChildren(),this.$player.on("mousemove.sliderHover",this.elSelector,i.bind(this.onMouseMove,this)),this.player.on("dispose",this.dispose)},createChildren:function(){this.children.hoverSliderHandle=new s(this.player),this.children.hoverSliderTime=new r(this.player),this.appendChildren()},appendChildren:function(){i.each(this.children,i.bind(function(t){this.$el.append(t.render().$el)},this))},updateChildren:function(t){i.each(this.children,function(e){e.update(t)})},onMouseMove:function(t){var e=n.findPosition(this.$el[0]),i=t.pageX-e.left,o=n.Slider.prototype.calculateDistance.apply(this.player.controlBar.progressControl,[t.originalEvent]),s=o*this.player.player().duration();this.updateChildren({hoverX:i,hoverTime:s})},dispose:function(){this.$player.off("mousemove.sliderHover"),i.each(this.children,function(t){i.result(t,"dispose")})}});e.exports=a},{"./base/base-plugin":3,"./hover-slider-handle":6,"./hover-slider-time":7,jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],9:[function(t,e){function i(t,e,i){n.isFunction(i)||(i=n.noop());var s=n.extend({},c,e);return o(t,s,i)}var n=t("lodash"),o=t("video.js"),s=t("./hover-slider"),r=t("./big-play-toggle"),a=t("./crt-seekbar");o.BigPlayToggle=r,o.CrtSeekBar=a;var l=function(t){this.hoverSlider=new s(this,t)};o.plugin("crt",l);var c={children:["mediaLoader","posterImage","loadingSpinner","bigPlayToggle",{name:"controlBar",children:["playToggle","currentTimeDisplay","timeDivider","durationDisplay","remainingTimeDisplay",{name:"progressControl",children:["crtSeekBar"]},"fullscreenToggle","muteToggle","playbackRateMenuButton"]},"errorDisplay"],plugins:{crt:{}},controls:!1,autoplay:!1,flash:{swf:"//assets.tumblr.com/assets/src/scripts/vendor/video-js/video-js-swf-4.4.1.swf"},techOrder:["html5","flash"]};e.exports=i},{"./big-play-toggle":4,"./crt-seekbar":5,"./hover-slider":8,lodash:"K2RcUv","video.js":"AcVSFw"}],10:[function(t,e){var i=t("prima/component"),n=t("prima/lib/domeventor"),o=i.extend({name:"GutterMediaManager",guttered_view:null,gutter_margin:20,gutter_width:215,max_view_width:300,viewport_transition_width:900,put_view_in_gutter:function(t){if(this.guttered_view!==t){var e={},i=!1;e.win_rect=n.rect(),e.gutter_position=this.gutter_position(),this.guttered_view&&(this.remove_guttered_view({was_displaced:!0}),i=!0),this.guttered_view=t,t.fall_in_the_gutter(e)}},remove_guttered_view:function(t){return this.remove_view_from_gutter(this.guttered_view,t)},remove_view_from_gutter:function(t,e){this.guttered_view===t&&(t.get_outta_the_gutter(e||{}),this.guttered_view=null)},gutter_position:function(){var t=n.rect(),e=this.viewport_transition_width/2-this.gutter_margin-this.gutter_width,i={width:this.max_view_width,left:"50%",bottom:20,translateX:e},o=this.max_view_width-this.gutter_width+this.viewport_transition_width;return t.windowWidth<o&&(i.width=o-t.windowWidth),i.width<this.gutter_width&&(i.width=this.gutter_width),i}});e.exports=new o},{"prima/component":27,"prima/lib/domeventor":32}],11:[function(t,e){"use strict";var i,n=t("prima/lib/data"),o=function(){return i||(i=n.get("Components/LogLady")),i};e.exports=o()},{"prima/lib/data":30}],12:[function(t,e){"use strict";function i(){for(var t,e=s.apply(arguments),i=o,r=0;r<e.length;r++){if(t=e[r],!i||!n.has(i,t))return;i=i[t]}return i}var n=t("lodash"),o=t("./bootstrap"),s=[].slice;e.exports=i},{"./bootstrap":11,lodash:"K2RcUv"}],13:[function(t,e){"use strict";function i(t,e,i){this.name=e,this.log_key=n.result(t,"log_key"),this.data=i||null;var o=s(),a=n.result(t,"generate_relative_id"),l=n.result(t,"env"),c=t.uuid,u={};u.log_key=this.log_key,u.uuid=c,u.event=this.name,u.ts=o,a!==!1&&void 0!==a&&(u.rid=a),u.elapsed=u.ts-r,u.data=this.data,u.env=l,this.json=u}var n=t("lodash"),o=t("prima/utils/realnow"),s=o.getRealNow,r=o.realStartedAt;e.exports=i},{lodash:"K2RcUv","prima/utils/realnow":50}],14:[function(t,e){"use strict";function i(t){this.watching={},this.pending_events=[],this.endpoint=t.endpoint,this._flush_from_timeout=n.bind(this._flush_from_timeout,this),this.set_flush_rate(),this.Log=f.extend({}),o(window).on("beforeunload.log_lady",n.bind(this._flush_on_unload,this))}var n=t("lodash"),o=t("jquery"),s=t("backbone"),r=t("prima/events"),a=t("prima/lib/flags"),l=t("prima/utils/realnow"),c=l.getRealNow,u=t("./utils/extend-with-defaults"),h=t("./utils/uuid"),d=[].slice,p=t("./config"),f=t("./log");n.extend(i.prototype,s.Events,{initialize:n.noop,defaults:{flush_rate:5e3},min_flush_rate:function(){var t=n.map(this.watching,function(t){return n.result(t,"flush_rate")});return t.push(this.defaults.flush_rate),n.min(t)},set_flush_rate:function(t){return t&&(this.defaults.flush_rate=t),this.flush_rate=this.min_flush_rate(),this.flush_is_overdue()&&this._flush_from_timeout(),this.flush_rate},flush:function(){var t=this.build_payload();if(!(t.events.length<1)&&a.bool("log_lady"))return o.ajax({url:this.endpoint,type:"POST",data:JSON.stringify(t),contentType:"application/json",async:!this.unloading}),!0},_flush_on_unload:function(){this._flush_timeout&&clearTimeout(this._flush_timeout),this._trigger_unloads(),this.unloading=!0,this.flush()},_trigger_unloads:function(){var t;for(var e in this.watching)t=this.watching[e],"function"==typeof t.unloaded&&t.unloaded()},_flush_from_timeout:function(){this._flush_timeout&&clearTimeout(this._flush_timeout),this.flush()!==!1&&(this._flush_timeout=setTimeout(this._flush_from_timeout,this.flush_rate))},since_last_flush:function(){return c()-this.last_flush_at},flush_is_overdue:function(){var t=this.since_last_flush();return t?t>this.flush_rate:!0},watch:function(){var t,e,i,o=d.apply(arguments);for(i=0;i<o.length;i++)t=o[i],this.is_valid(t)&&(t.log_lady=this,this.watching[t.log_key]&&(e=this.watching[t.log_key],e&&n.isFunction(e.replaced)&&e.replaced(t)),this.watching[t.log_key]=t);return this.set_flush_rate(),this},pending_log_events:function(){var t=this.pending_events;return this.pending_events=[],t},build_payload:function(){var t=n.keys(p("keys")),e=n.merge({},this.watching,[this]),i=n(e).collect(function(t){return t.pending_log_events()}).flatten().filter(function(e){return t.indexOf(e.log_key)>=0}).collect(function(t){return t.json}).value();return{events:i}},is_valid:function(t){var e=!!t;return e&&(e=n.result(t,"log_key")),e&&(e=n.result(t,"uuid")),e&&(e=n.isFunction(t.pending_log_events)),e},log:function(t,e){if(t){if(!(t in this.watching)){e&&e.log_key&&console.warn("log key gets overridden by log name");var i=p("keys",t);e=n.extend({},i,e,{log_key:t});var o=new this.Log(e);this.watch(o)}return this.watching[t]}},new_uuid:h}),i.extend=u,i.Log=f;var m=new i({endpoint:"/svc/log/lady"});r.on("Capture:push",function(t,e,i){m.log(t,{init_event:!1}).trigger(e,i)}),e.exports=m},{"./config":12,"./log":15,"./utils/extend-with-defaults":18,"./utils/uuid":19,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/events":28,"prima/lib/flags":35,"prima/utils/realnow":50}],15:[function(t,e){"use strict";function i(t,e){t.uuid?(e=t,t=e.uuid,delete e.uuid):e||!t||n.isString(t)||(e=t,t=void 0),this.options=n.extend({},this.defaults,e),delete this.options.log_key,delete this.options.env,delete this.options.uuid,a(this,"uuid",t||this._generate_uuid()),e.env||(e.env={}),n.each(e.flags,function(t){e.env.flags||(e.env.flags={}),e.env.flags[t]=s.bool(t)}),a(this,"env",e.env),this.log_key=e.log_key||this.log_key,this.events=[],this.pending_events=[],this.event_counts={},this.started_at||(this.started_at=this.options.started_at||r.getRealNow()),delete this.options.started_at,this.initialize(e),this.options.init_event&&this.trigger("init")}var n=t("lodash"),o=t("backbone"),s=t("prima/lib/flags"),r=t("prima/utils/realnow"),a=t("./utils/define-immutable-property"),l=t("./utils/extend-with-defaults"),c=t("./utils/uuid"),u=t("./config"),h=t("./event");n.extend(i.prototype,o.Events,{initialize:n.noop,_generate_uuid:function(){return u("default_session")||c()},defaults:{init_event:!0,keep_counts:!1},pending_log_events:function(){var t=this.pending_events;return this.pending_events=[],t},generate_relative_id:function(){return this.events.length},unloaded:function(t){t||(t={}),t=this.before_unloaded(t)||{},this.options.keep_counts&&n.extend(t,{event_counts:this.event_counts}),n.isEmpty(t)||this.trigger("unload",t)},before_unloaded:function(t){return t},replaced:function(t){this.before_replaced(t);for(var e=this.pending_log_events();e.length;)this.log_lady.pending_events.push(e.shift())},before_replaced:n.noop,trigger:function(t,e){var i=new h(this,t,e);return this.options.keep_counts&&"init"!==t&&"unload"!==t&&(this.event_counts[t]||(this.event_counts[t]=0),this.event_counts[t]++),this.pending_events.push(i),o.Events.trigger.call(this,t,i,this),this}}),i.extend=l,e.exports=i},{"./config":12,"./event":13,"./utils/define-immutable-property":17,"./utils/extend-with-defaults":18,"./utils/uuid":19,backbone:"5kFNoY",lodash:"K2RcUv","prima/lib/flags":35,"prima/utils/realnow":50}],16:[function(t,e){"use strict";function i(t){var e,n;Object.freeze(t);for(n in t)e=t[n],t.hasOwnProperty(n)&&null!==e&&"object"==typeof e&&!Object.isFrozen(e)&&i(e)}e.exports=i},{}],17:[function(t,e){"use strict";function i(t,e,i){n.isObject(i)&&o(i),Object.defineProperty(t,e,{value:i,writeable:!1,enumerable:!0,configurable:!1})}var n=t("lodash"),o=t("./deepfreeze");e.exports=i},{"./deepfreeze":16,lodash:"K2RcUv"}],18:[function(t,e){"use strict";function i(t,e){var i,o=this;i=t&&n.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},n.extend(i,o,e);var s=function(){this.constructor=i};return s.prototype=o.prototype,i.prototype=new s,t.defaults&&(n.extend(i.prototype.defaults,t.defaults),delete t.defaults),t&&n.extend(i.prototype,t),i.__super__=o.prototype,i}var n=t("lodash");e.exports=i},{lodash:"K2RcUv"}],19:[function(t,e){"use strict";function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)})}e.exports=i},{}],20:[function(t,e){var i=t("lodash"),n=t("prima/component"),o=t("./models/tour_guide_model"),s=t("./views/tour_guide_view"),r=t("prima/events"),a=n.extend({name:"TourGuide",defaults:{},initialize:function(t){this.options=i.extend({},this.defaults,t),this.model=new o,this.view=new s({model:this.model}),this.options.wait&&this.options.wait_event?r.once(this.options.wait_event,this.view.start,this):this.view.start()}});e.exports=a},{"./models/tour_guide_model":21,"./views/tour_guide_view":23,lodash:"K2RcUv","prima/component":27,"prima/events":28}],21:[function(t,e){var i=t("prima/model"),n=t("lodash"),o=t("jquery"),s=i.extend({url:"/svc/guidedtour/dashboard/itinerary",initialize:function(){},parse:function(t){return t.response},unset_attribute:function(t,e,i){t&&e&&this.set(e,n.omit(this.get(e),t),{silent:i||!1})},move_to_hover:function(t){if(t&&t.name){var e=n.clone(this.get("hoverable"))||{};e[t.name]=t,this.set("hoverable",e),this.unset_attribute(t.name,"automatic",!0)}},move_to_last:function(t){if(t&&t.name){var e=n.clone(this.get("automatic"))||{},i=n.keys(e),o=n.toArray(e);o.length>1&&(o=n.without(o,t),o.push(t),i=n.without(i,t.name),i.push(t.name),e=n.zipObject(i,o),this.set("automatic",e,{silent:!0}))}},log:function(t){o.ajax({url:this.url,with_form_key:!0,type:"POST",data:t})}});e.exports=s},{jquery:"HlZQrA",lodash:"K2RcUv","prima/model":44}],22:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="","undefined"!=typeof template&&"standard"===template?(__p+='<div class="popover '+(null==(__t=name)?"":_.escape(__t))+'_step">',"undefined"!=typeof title&&(__p+='<h3 class="title">'+(null==(__t=title)?"":__t)+"</h3>"),__p+='<p class="content">'+(null==(__t=content)?"":_.escape(__t))+"</p>","undefined"!=typeof ok_text&&(__p+='<button class="chrome blue ok_button" type="button">'+(null==(__t=ok_text)?"":_.escape(__t))+"</button> "),__p+="</div>"):"undefined"!=typeof template&&"appearance"===template&&(__p+='<div class="popover '+(null==(__t=name)?"":_.escape(__t))+'_step"><div class="popover_inner">',"undefined"!=typeof title&&(__p+='<h3 class="title">'+(null==(__t=title)?"":__t)+"</h3>"),__p+='<p class="content">'+(null==(__t=content)?"":_.escape(__t))+'</p></div><div class="appearance small" style="background-color:'+(null==(__t=appearance_data.global_theme_params.background_color)?"":_.escape(__t))+"; color:"+(null==(__t=appearance_data.global_theme_params.background_color)?"":_.escape(__t))+'"><div class="navigation"><h3 class="tumblelog_name"><a href="'+(null==(__t=appearance_data.url)?"":_.escape(__t))+'" target="_blank">'+(null==(__t=appearance_data.name)?"":_.escape(__t))+'</a></h3><a class="chrome edit_button" href="/settings/blog/'+(null==(__t=appearance_data.name)?"":_.escape(__t))+'">'+(null==(__t=edit_text)?"":_.escape(__t))+'</a></div><div class="header_image" style="background-image:url('+(null==(__t=appearance_data.global_theme_params.header_image_focused)?"":_.escape(__t))+')"></div><div class="avatar '+(null==(__t=appearance_data.global_theme_params.avatar_shape)?"":_.escape(__t))+'" style="background-image:url('+(null==(__t=appearance_data.avatar_url)?"":_.escape(__t))+')"><img src="'+(null==(__t=appearance_data.avatar_url)?"":_.escape(__t))+'" alt=""></div><div class="info" style="color:'+(null==(__t=appearance_data.global_theme_params.title_color)?"":_.escape(__t))+'">',appearance_data.title&&(__p+='<h1 class="title" style="font-weight:'+(null==(__t=appearance_data.global_theme_params.title_font_weight)?"":_.escape(__t))+'">'+(null==(__t=appearance_data.title)?"":_.escape(__t))+"</h1>"),__p+="",appearance_data.description&&(__p+='<div class="description"><p class="description_inner">'+(null==(__t=appearance_data.description)?"":_.escape(__t))+"</p></div>"),__p+="</div></div></div>"),__p+='<div class="glass"></div>';return __p}},{underscore:"K2RcUv"}],23:[function(t,e){var i=t("jquery"),n=t("lodash"),o=t("prima/view"),s=t("prima/events"),r=t("prima/utils/cookie"),a=t("prima/lib/domeventor"),l=t("../templates/tour_guide.tpl"),c=o.extend({className:"tour_guide",template:l,defaults:{hover_step_timeout:2e3,reactive_step_timeout:4e3,step_timeout:2e4,storage_key:"dashboard_tour_guide"},is_suspended:!1,events:{"click .glass":"__glass_click","click .ok_button":"__ok_click"},__glass_click:function(t){t.preventDefault(),this.hide(!0)},__ok_click:function(t){t.preventDefault(),this.hide(!0)},__target_mouseover:function(t,e,i){i=i?i:"automatic",this.show_inline_step(e,i,t.currentTarget),this.model.move_to_hover(this.current_step)},__target_mouseout:function(t,e){this.rebind_hover_step(t.currentTarget,n.bind(function(){this.__target_mouseover(t,e,"hoverable")},this),e),this.hide_inline_step()},__scroll:function(t){this.scroll_position=t,this.is_scrolling=!0,this.is_dim&&this.fade_glass(),this.scroll_timeout&&(clearTimeout(this.scroll_timeout),this.scroll_timeout=null),this.scroll_timeout=setTimeout(n.bind(function(){this.is_scrolling=!1,this.is_queued&&this.render_if_visible_element()},this),200)},__post_like_success:function(t){if(this.model.get("reactive")&&this.model.get("reactive").like){var e=this.$posts.find('[data-post-id="'+t+'"] .post_control.like').get(0);this.model.unset_attribute("like","hoverable"),this.show_inline_step("like","reactive",e)}},__post_form_show:function(){this.suspend()},__post_form_hide:function(){this.resume()},__post_form_success:function(t){t&&t.reblog&&(this.resume(),this.show_inline_step("reblog","reactive"))},__post_follow_success:function(){this.model.get("reactive")&&this.model.get("reactive").follow&&this.show_inline_step("follow","reactive")},__search_focus:function(){this.is_open&&"search"===this.current_step.name||this.suspend()},__search_blur:function(){this.is_open&&"search"===this.current_step.name||this.resume()},__model_change:function(){this.$body.off(".tour_guide_hover"),n.each(this.model.get("automatic"),function(t){t.hover===!0&&(this.$body.one("mouseover.tour_guide_hover",t.target,n.bind(function(e){this.__target_mouseover(e,t.name)},this)),this.$body.one("mouseout.tour_guide_hover",t.target,n.bind(function(e){n.has(this.model.get("hoverable"),t.name)&&this.__target_mouseout(e,t.name)},this)))},this);try{c.set_cookie(this.options.storage_key,this.model.toJSON())}catch(t){}this.update_step()},_bind_events:function(){this.listenTo(this.model,"change:automatic",this.__model_change),this.listenTo(s,"DOMEventor:flatscroll",this.__scroll),this.listenTo(s,"post:form:show",this.__post_form_show),this.listenTo(s,"post:form:hide",this.__post_form_hide),this.listenToOnce(s,"post:like:success",this.__post_like_success),this.listenToOnce(s,"post:form:success",this.__post_form_success),this.listenToOnce(s,"post:follow:success",this.__post_follow_success),this.$search_query.on("focus.tour_guide",n.bind(this.__search_focus,this)),this.$search_query.on("blur.tour_guide",n.bind(this.__search_blur,this))},_step_timeout:function(){var t=this.model.get("automatic");this.current_step&&n.size(t)>1&&(this.model.move_to_last(this.current_step),this.update_step())},initialize:function(t){this.options=n.extend({},this.defaults,t||{}),this.$body=i("body"),this.$posts=i("#posts"),this.$search_field=i("#search_field"),this.$search_query=i("#search_query"),this.$highlighted=i(),this.$glass=i(),this.$popover=i(),this.is_dim=!1,this.is_open=!1,this.is_queued=!1,this.is_scrolling=!1,this.step_timeout=null,this.step_render_timeout=null,this.hover_timeout=null,this.scroll_timeout=null,this.current_step=null,this.open_scroll_position=0,this.highlighted_element_class="",this.transition_end=c.get_transition_end(),this.scroll_position=a.rect(),this._bind_events(),s.trigger("TourGuideView:initialized")},start:function(){var t=c.get_cookie(this.options.storage_key);t!==!1?this.model.set(t):this.model.fetch(),s.trigger("TourGuideView:started")},update_step:function(){var t=n.first(n.toArray(this.model.get("automatic")));t&&!n.isEmpty(t)&&(this.remove(),this.current_step=t,this.step_render_timeout=setTimeout(n.bind(this.pre_render,this),t.delay||0))},show_inline_step:function(t,e,o){if(t){var s,r="reactive"===e?!0:!1;switch(this.hover_timeout&&(clearTimeout(this.hover_timeout),this.hover_timeout=null),this.remove(),e){case"reactive":s=this.model.get("reactive");break;case"hoverable":s=this.model.get("hoverable");break;default:s=this.model.get("automatic")}this.current_step=n.result(s,t),this.$highlighted=i(o),this.current_step&&(r&&this.current_step.name&&(this.$body.off(".tour_guide_hover"),this.$body.find("[data-tour-guide-"+this.current_step.name+"]").off(".tour_guide_hover")),this.pre_render(!0,r))}},pre_render:function(t,e){if(!this.is_suspended){if(t=t||!1,this.step_render_timeout&&(clearTimeout(this.step_render_timeout),this.step_render_timeout=null),this.reactive_timeout&&(clearTimeout(this.reactive_timeout),this.reactive_timeout=null),e&&this.hide_inline_step(this.options.reactive_step_timeout),this.is_scrolling)return void(this.is_queued=!0);this.step_timeout&&(clearTimeout(this.step_timeout),this.step_timeout=null),this.step_timeout=setTimeout(n.bind(this._step_timeout,this),this.options.step_timeout),t||!this.current_step.target||this.$highlighted.length?this.render(t):this.render_if_visible_element()}},render:function(t){if(this.current_step){var e;if(this.$el.html(this.template(this.current_step)),this.$body.addClass("tour_guide_open").append(this.$el),this.is_open=!0,this.is_queued=!1,this.highlighted_element_class="",this.step_timeout&&(clearTimeout(this.step_timeout),this.step_timeout=null),!t&&this.current_step.glass&&(this.$el.addClass("dim"),this.is_dim=!0),!t&&this.$highlighted.length){switch(this.current_step.name){case"search":this.highlighted_element_class="search_form_active"}this.$highlighted.addClass("tour_guide_element").addClass(this.highlighted_element_class)}return this.open_scroll_position=this.$highlighted.length?this.scroll_position.windowScrollTop:this.scroll_position.windowScrollTop+.5*this.scroll_position.windowHeight,this.$glass=this.$(".glass"),this.$popover=this.$(".popover"),this.delegateEvents(),this.position_popover(),this.$highlighted&&this.$highlighted.length&&(e=this.$highlighted.closest(".post").data("json")),s.trigger("TourGuideView:render:step",{post_data:e,step:this.current_step.name}),this}},suspend:function(t){t=t||!1,this.is_suspended||(this.is_suspended=!0,clearTimeout(this.step_render_timeout),this.hide(t))},resume:function(){this.is_suspended&&(this.is_suspended=!1,this.update_step())},render_if_visible_element:function(){this.current_step.target&&(this.$highlighted=this.visible_highlighted_element(),this.$highlighted.length?this.pre_render():this.is_queued=!0)},hide:function(t){var e=this.current_step?this.current_step.name:void 0;this.$el.addClass("removing"),this.transition_end?this.$el.one(this.transition_end,n.bind(this.remove,this)):this.remove(),t&&this.current_step&&(this.model.unset_attribute(this.current_step.name,"automatic"),this.model.log({step:e,action:"hide"})),s.trigger("TourGuideView:hide",{step:e})},remove:function(){this.undelegateEvents(),this.is_dim=!1,this.is_open=!1,this.is_queued=!1,this.has_posts=!1,this.current_step=null,this.$el.removeClass("dim removing").remove(),this.$body.removeClass("tour_guide_open"),this.$highlighted.length&&(this.$highlighted.off(".tour_guide_highlighted").removeClass("tour_guide_element").removeClass(this.highlighted_element_class),this.$highlighted=i(),this.highlighted_element_class="")},hide_inline_step:function(t){t=t||this.options.hover_timeout,this.hover_timeout=setTimeout(n.bind(function(){this.hide(),this.update_step()},this),t)},rebind_hover_step:function(t,e,o){if(t&&e){var s=i(t);s.attr("data-tour-guide-"+o,!0),s.on("mouseover.tour_guide_hover",n.bind(e,this)),s.on("mouseout.tour_guide_hover",n.bind(this.hide_inline_step,this))}},fade_glass:function(){var t=(this.open_scroll_position-this.scroll_position.windowScrollTop)/this.scroll_position.windowHeight,e=t>0?1-t:t+1;return 0>=e?(this.is_dim=!1,void this.hide(!0)):void this.$glass.css("opacity",e)},position_popover:function(){if(this.$popover.length){var t=this.$popover.outerHeight(!0),e=this.$popover.outerWidth(!0);if(this.$highlighted.length){var i=this.$highlighted.offset(),n=i.left+.5*this.$highlighted.outerWidth(),o=i.top;this.$popover.css("left",n-.5*e),o-t>this.scroll_position.windowScrollTop+80?this.$popover.css("top",o-t):this.$popover.css("top",o+this.$highlighted.outerHeight())}else this.$popover.addClass("centered").css({left:.5*this.scroll_position.windowWidth-.5*e,top:.5*this.scroll_position.windowHeight-.5*t})}},visible_highlighted_element:function(){if(this.current_step){var t=i(),e=this.scroll_position.windowScrollTop,n=this.scroll_position.windowScrollTop+this.scroll_position.windowHeight;return i(this.current_step.target).each(function(){var o=i(this),s=o.offset();return s.top>e&&s.top+o.height()<n?(t=o,!1):void 0}),t}}},{get_transition_end:function(){var t,e=document.createElement("div"),i={transition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in i)if(void 0!==e.style[t])return i[t];return!1},set_cookie:function(t,e){n.isObject(e)&&r.setHash(t,"steps",e,{expires:86400})},get_cookie:function(t){return r.has(t)?r.getHash(t,"steps"):!1}});e.exports=c},{"../templates/tour_guide.tpl":22,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":28,"prima/lib/domeventor":32,"prima/utils/cookie":46,"prima/view":52}],context:[function(t,e){e.exports=t("azPbt+")},{}],"azPbt+":[function(t,e){"use strict";var i=(t("jquery"),t("prima/router")),n=(t("prima/lib/domeventor"),t("./components/tour_guide")),o=t("prima/lib/flags"),s=t("components/crt"),r=i.extend({routes:{dashboard:"dashboard"},initialize:function(){this.crtControl=new s},dashboard:function(){if(o.bool("onboarding_tour_guide")){var t=o.bool("onboarding_tag_bingo"),e="onboarding:tag_bingo_interstitial:completed";this.tour_guide=new n({wait:t,wait_event:e})}}});e.exports=r},{"./components/tour_guide":20,"components/crt":2,jquery:"HlZQrA","prima/lib/domeventor":32,"prima/lib/flags":35,"prima/router":45}],26:[function(t,e){function i(){}var n=t("backbone"),o=t("./lib/extendwithmixins");i.extend=n.Model.extend,o.applyTo(i),e.exports=i},{"./lib/extendwithmixins":34,backbone:"5kFNoY"}],27:[function(t,e){var i=(t("jquery"),t("lodash")),n=(t("backbone"),t("./class")),o=t("./lib/data"),s=(t("./lib/logger"),n.extend({name:!1,initialize:i.noop,constructor:function(t){this.cid=i.uniqueId("component"),this.options=t||(t={}),this.initialize.apply(this,arguments),this.styles&&i.isFunction(this.styles.append)&&this.styles.append()},remove:function(){this.styles&&i.isFunction(this.styles.remove)&&this.styles.remove()},getOwnData:function(){return o.get("Components/"+this.name)},render:function(){}}));e.exports=s},{"./class":26,"./lib/data":30,"./lib/logger":37,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv"}],28:[function(t,e){var i=t("./lib/mediator"),n=i.extend();e.exports=new n},{"./lib/mediator":38}],29:[function(t,e){"use strict";
var i=t("prima/utils/exposer");i({"Tumblr.Prima.Ligature":t("ligature"),"Tumblr.Events":t("prima/events"),"Tumblr.Prima.Events":t("prima/events"),"Tumblr.Prima.DOMEventor":t("prima/lib/domeventor"),"Tumblr.Prima.gutter_media_manager":t("components/gutter_media_manager"),"Tumblr.log_lady":t("components/loglady"),"Tumblr.Prima.logLady":t("components/loglady")}),e.exports=i},{"components/gutter_media_manager":10,"components/loglady":14,ligature:57,"prima/events":28,"prima/lib/domeventor":32,"prima/utils/exposer":47}],30:[function(t,e){function i(t){if(!o)throw new Error("Data hasn't been initialized with `setup`.");if(!s.isString(t))return null;var e=r(o,t.replace("/","."));return s(e).cloneDeep()}function n(t){o=s.isObject(t)?t:{}}var o,s=t("lodash"),r=t("../utils/getpath");e.exports={get:i,setup:s.once(n)}},{"../utils/getpath":48,lodash:"K2RcUv"}],31:[function(t,e){function i(t,e){var i=t.apply(this,e);return e=Array.prototype.slice.call(e,1),e.unshift(i),e}function n(t){t=o.extend({entries:{},name:"Dictionary"},t),this._hadLastLookup=!1,this._entries=t.entries,this._name=t.name}{var o=t("lodash");t("./logger")}n.prototype.addEntries=function(t){return o.extend(this._entries,t),this},n.prototype.lookup=function(t){return o.has(this._entries,t)?(this._hadLastLookup=!0,this._entries[t]):(this._hadLastLookup=!1,t)},n.prototype.lookupWithFormatting=function(t){var e;return arguments.length>1?(e=this.lookup(o.sprintf.apply(this,arguments)),this._hadLastLookup||(e=o.sprintf.apply(this,i(this.lookup,arguments)))):e=this.lookup(t),e},n.prototype.get=function(t){var e=this.lookupWithFormatting.apply(this,arguments);return!this._hadLastLookup,e},n.prototype.getEntries=function(){return o(this._entries).cloneDeep()},e.exports=n},{"./logger":37,lodash:"K2RcUv"}],32:[function(t,e){function i(){function t(){o(),u.trigger("DOMEventor:flatresize",p),e=!1}var e;d.on("resize.DOMEventor-nextResizeLoop",function(){e||(m(t),e=!0)})}function n(){function t(){i--||(f.documentHeight=p.documentHeight,p.documentHeight=h.height(),i=1),f.windowScrollTop=f.windowScrollY=p.windowScrollTop,p.windowScrollTop=p.windowScrollY=d.scrollTop(),u.trigger("DOMEventor:flatscroll",p),e=!1}var e,i=0;d.on("scroll.DOMEventor-nextScrollLoop",function(){e||(m(t),e=!0)})}function o(){f.documentHeight=p.documentHeight,p.documentHeight=h.height(),f.windowHeight=p.windowHeight,p.windowHeight=d.height(),f.windowWidth=p.windowWidth,p.windowWidth=d.width(),f.windowScrollTop=f.windowScrollY=p.windowScrollTop,p.windowScrollTop=p.windowScrollY=d.scrollTop()}function s(){var t={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"leftmeta",92:"rightmeta",93:"rightmeta",96:"num0",97:"num1",98:"num2",99:"num3",100:"num4",101:"num5",102:"num6",103:"num7",104:"num8",105:"num9",106:"multiply",107:"add",109:"subtract",110:"decimal",111:"devide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"forwardslash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebracket",222:"singlequote"};h.on("keydown.DOMEventor keyup.DOMEventor",function(e){var i=e.type;if("keyup"===i||"keydown"===i){var n=c(e.target),o=e.which;if(!((n.is("input")||n.is("textarea")||n.is("select"))&&o>=48&&90>=o)||e.metaKey||e.ctrlKey||e.altKey){var s=i+":"+(e.altKey&&18!==o?"alt+":"")+(e.ctrlKey&&17!==o?"ctrl+":"")+(e.metaKey&&91!==o&&92!==o&&93!==o?"meta+":"")+(e.shiftKey&&16!==o?"shift+":"")+(t[o]||"");u.trigger("DOMEventor:"+s,e,s)}}}),u.off("DOMEventor:startKeyboardObserver"),u.on("DOMEventor:stopKeyboardObserver",r)}function r(){h.off("keydown.DOMEventor keyup.DOMEventor"),u.on("DOMEventor:startKeyboardObserver",s),u.off("DOMEventor:stopKeyboardObserver")}function a(){o(),n(),i(),s(),u.on("DOMEventor:updateRect",o)}var l=t("lodash"),c=t("jquery"),u=t("../events"),h=c(document),d=c(window),p={},f={};p.documentHeight=f.documentHeight=null,p.windowHeight=f.windowHeight=null,p.windowWidth=f.windowHeight=null,p.windowScrollTop=f.windowScrollTop=null,p.windowScrollY=f.windowScrollY=null;var m=!Object.hasOwnProperty.call(window,"requestAnimationFrame")&&window.requestAnimationFrame||!Object.hasOwnProperty.call(window,"webkitRequestAnimationFrame")&&window.webkitRequestAnimationFrame||!Object.hasOwnProperty.call(window,"mozRequestAnimationFrame")&&window.mozRequestAnimationFrame||!Object.hasOwnProperty.call(window,"oRequestAnimationFrame")&&window.oRequestAnimationFrame||function(t){window.setTimeout(function(){t()},50)},_={init:l.once(a),rect:function(){return p},lastRect:function(){return f}};e.exports=_},{"../events":28,jquery:"HlZQrA",lodash:"K2RcUv"}],33:[function(t,e){function i(t){function e(){s.removeEventListener("DOMContentLoaded",e),t()}s.addEventListener("DOMContentLoaded",e)}function n(t){o||(o=/^loaded|^i|^c/.test(s.readyState)),o?setTimeout(t):i(t)}var o,s=document;e.exports=n},{}],34:[function(t,e){function i(t){var e=s.apply(this,arguments);return o.has(t,"mixins")&&t.mixins.forEach(function(t){t.applyTo(e.prototype)}),e}function n(t){t.extend=i}var o=t("lodash"),s=t("backbone").Model.extend;e.exports.applyTo=n},{backbone:"5kFNoY",lodash:"K2RcUv"}],35:[function(t,e){function i(t){return!!s[t]}function n(t){var e=i(t);return e?function n(t){var i=r.isFunction(t)?t.call(this,e):t;return r.isUndefined(i)?n:i}:function o(t,i){var n=r.isFunction(i)?i.call(this,e):i;return r.isUndefined(n)?o:n}}function o(t){s=r.isObject(t)?t:{}}var s,r=t("lodash");e.exports=n,e.exports.bool=i,e.exports.setup=r.once(o)},{lodash:"K2RcUv"}],36:[function(t,e){var i=t("lodash"),n={};n.getOption=function(t,e){if(t&&e){var i;return i=t.options&&e in t.options&&void 0!==t.options[e]?t.options[e]:t[e]}},n.slice=function(t){return Array.prototype.slice.call(t)};var o=function(){function t(t,e,i){return i.toUpperCase()}var e=/(^|:)(\w)/gi,n=function(n){var o="on"+n.replace(e,t),s=this[o];return i.isFunction(this.trigger)&&this.trigger.apply(this,arguments),i.isFunction(s)?s.apply(this,i.tail(arguments)):void 0};return n}();n.triggerMethod=o,n.toTitleCase=function(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})},e.exports=n},{lodash:"K2RcUv"}],37:[function(t,e){{var i=t("lodash");t("./domready")}e.exports.log=i.noop,e.exports.flush=i.noop},{"./domready":33,lodash:"K2RcUv"}],38:[function(t,e){var i=t("lodash"),n=t("../lib/helpers"),o=function(t){this.triggerMethod=n.triggerMethod,this.options=t||{},i.isFunction(this.initialize)&&this.initialize(this.options)};o.extend=Backbone.Model.extend,i.extend(o.prototype,Backbone.Events,{close:function(){this.stopListening(),this.triggerMethod("close"),this.unbind()}}),e.exports=o},{"../lib/helpers":36,lodash:"K2RcUv"}],39:[function(t,e){function i(t,e){l.each(e,function(e,i){var n=t[i];t[i]=function(){return e.apply(this,arguments),n.apply(this,arguments)}})}function n(t,e){l.each(e,function(e,i){var n=t[i];t[i]=function(){var t=n.apply(this,arguments);return e.apply(this,arguments),t}})}function o(t,e){l.each(e,function(e,i){var n=t[i];t[i]=function(){var t=l.toArray(arguments);return t.unshift(l.bind(n,this)),e.apply(this,t)}})}function s(t,e){l.defaults(t,e)}function r(t,e){l.extend(t,l.omit(e,"before","after","around","defaults","applyTo"))}function a(){this.mixins=l.filter(arguments,function(t){return t instanceof a}),this.properties=arguments[this.mixins.length]||{}}var l=t("lodash");a.prototype.mixins=null,a.prototype.properties=null,a.prototype.applyTo=function(t){var e=this.properties;s(t,e.defaults),r(t,e),l.invoke(this.mixins,"applyTo",t),i(t,e.before),n(t,e.after),o(t,e.around),l.isFunction(e.applyTo)&&e.applyTo.apply(this,arguments)},e.exports=a},{lodash:"K2RcUv"}],40:[function(t,e){function i(){return l||(l=[u("January"),u("February"),u("March"),u("April"),u("May"),u("June"),u("July"),u("August"),u("September"),u("October"),u("November"),u("December")]),l}function n(){return c||(c=[u("Jan"),u("Feb"),u("Mar"),u("Apr"),u("May"),u("Jun"),u("Jul"),u("Aug"),u("Sep"),u("Oct"),u("Nov"),u("Dec")]),c}function o(){return c||(c=[u("Sunday"),u("Monday"),u("Tuesday"),u("Wednesday"),u("Thursday"),u("Friday"),u("Saturday")]),c}function s(t,e){var n=i();return t=_.parseInt(t),e?_.result(n,t)||"":_.result(n,t-1)||""}function r(t,e){var i=n();return t=_.parseInt(t),e?_.result(i,t)||"":_.result(i,t-1)||""}function a(t){var e=o();return t=_.parseInt(t),_.result(e,t%7)||""}var l,c,u=t("../translations").get;e.exports={getMonth:s,getShortMonth:r,getWeekday:a,monthNames:function(t){var e=t?i():n();return _.transform(_.range(12),function(t,i){t[i+1]=e[i]},{})},weekdayNames:function(){var t=o();return _.transform(_.range(7),function(e,i){e[i]=t[i]},{})}}},{"../translations":41}],41:[function(t,e){function i(t){s.addEntries(n.isObject(t)?t:{})}var n=t("lodash"),o=t("../dictionary"),s=new o({name:"Translations"});e.exports={get:n.bind(s.get,s),setup:n.once(i)}},{"../dictionary":31,"./dates":40,lodash:"K2RcUv"}],42:[function(t,e){var i=t("lodash"),n=t("backbone"),o=t("../lib/mixin"),s=n.Model.prototype,r=new o({defaults:i.extend({},n.Events),get:s.get,has:s.has,set:s.set,unset:s.unset,clear:s.clear,hasChanged:s.hasChanged,changedAttributes:s.changedAttributes,previous:s.previous,toJSON:s.toJSON,toggle:function(t){this.set(t,!this.get(t))},_validate:i.constant(!0),before:{initialize:function(){var t=i.defaults({},i.result(this,"defaults"));this.attributes={},this.set(t),this.changed={}}}});e.exports=r},{"../lib/mixin":39,backbone:"5kFNoY",lodash:"K2RcUv"}],43:[function(t,e){function i(t){return c.trim(t)}function n(t,e){return t=i(t),e&&c.isFunction(this.$$)&&delete this.$$.cache[t],t}function o(t){return this.$$?(t=i(t),this.$(t)):void 0}function s(t){this.$$&&(t=i(t),delete this.$$.cache[t])}function r(t){return this.$$?(t=i(t),delete this.$$.cache[t],this.$(t)):void 0}function a(){this.$$&&(c.forEach(this.$$.cache,function(t,e,i){delete i[e]}),this.$$.cache={})}function l(t){return function(){var t=c.memoize(c.bind(o,this),n);return t.update=c.bind(r,this),t.remove=c.bind(s,this),t.empty=c.bind(a,this),this.$$=t,this.$$initialize=c.noop,t}.call(t)}var c=t("lodash"),u=t("../lib/mixin"),h=new u({defaults:{$$cacheKeys:{},$$cacheSelectors:function(t){return"undefined"==typeof t&&(t=this.$$cacheKeys),c.forEach(t,function(t){this.$$.update(t)},this),this},$$initialize:function(){return l(this)},$$:function(){return l(this).apply(this,arguments)}},before:{initialize:function(){this.$$initialize()}},after:{setElement:function(){c.isFunction(this.$$.empty)&&this.$$.empty()},remove:function(){c.isFunction(this.$$.empty)&&this.$$.empty()},render:function(){c.isFunction(this.$$cacheSelectors)&&this.$$cacheSelectors()}}});e.exports=h},{"../lib/mixin":39,lodash:"K2RcUv"}],44:[function(t,e){var i=t("backbone"),n=t("./lib/extendwithmixins"),o=i.Model.extend({});n.applyTo(o),e.exports=o},{"./lib/extendwithmixins":34,backbone:"5kFNoY"}],45:[function(t,e){var i=t("lodash"),n=t("backbone"),o=t("./lib/data"),s=t("./lib/flags"),r=t("./lib/translations"),a=t("./lib/domeventor"),l=(t("./lib/logger"),n.Router.extend({root:"/",constructor:function(){this.name=o.get("Context/name"),n.Router.apply(this,arguments),a.init(),n.History.started||i.isEmpty(this.routes)||(this.routeFound=n.history.start({pushState:"pushState"in window.history,hashChange:!1,root:this.root}))}},{bootloader:function(e){o.setup(e),s.setup(e.Flags.doods),r.setup(e.Translations),t("./legacy");var i=t("context");new i}}));e.exports=l},{"./legacy":29,"./lib/data":30,"./lib/domeventor":32,"./lib/flags":35,"./lib/logger":37,"./lib/translations":41,backbone:"5kFNoY",context:"azPbt+",lodash:"K2RcUv"}],46:[function(t,e){function i(t){return new RegExp(t+"=([^;]+)").test(decodeURIComponent(document.cookie))}function n(t){return new RegExp(t+"=([^;]+)").test(decodeURIComponent(document.cookie))?RegExp.$1:null}function o(t,e,i,n){"object"==typeof e&&(e=JSON.stringify(e));var o=encodeURIComponent(t)+"="+encodeURIComponent(e);if(l.isPlainObject(i)&&(n=i,i=n?n.expires:!1),n=l.extend({expires:i},h,n),n.expires instanceof Date)o+=";expires="+n.expires.toGMTString();else if("number"==typeof n.expires){var s=new Date;s.setTime(s.getTime()+1e3*n.expires),o+=";expires="+s.toGMTString()}n.path&&(o+=";path="+encodeURI(n.path)),n.secure&&(o+=";secure"),n.domain&&(o+=";domain="+encodeURI(n.domain)),document.cookie=o}function s(t){o(t,"",-1)}function r(t,e){var i=n(t);try{i=JSON.parse(i)}catch(o){return i}return e?u(i,e):i}function a(t,e,i,n){var s;l.isPlainObject(e)?(n=i,s=e):(s=r(t)||{},l.isPlainObject(s)||(s={}),c(s,e,i)),o(t,JSON.stringify(s),n)}var l=t("lodash"),c=t("./setpath"),u=t("./getpath"),h={path:"/",secure:!1,domain:""},d={has:i,get:n,set:o,unset:s,getHash:r,setHash:a};e.exports=d},{"./getpath":48,"./setpath":51,lodash:"K2RcUv"}],47:[function(t,e){function i(t){var e=window;n.each(t,function(t,i){if(s(e,i))throw new Error('"'+i+'" already exists');o.log("Exposer","%s.%s",e,i),r(e,i,t)})}var n=t("lodash"),o=t("../lib/logger"),s=t("./haspath"),r=t("./setpath");e.exports=i},{"../lib/logger":37,"./haspath":49,"./setpath":51,lodash:"K2RcUv"}],48:[function(t,e){function i(t,e){"string"==typeof t&&(e=t,t=window),e=e.split(".");for(var i;;){if(i=e.shift(),!(i in t))return;if(0===e.length)return t[i];t=t[i]}}e.exports=i},{}],49:[function(t,e){function i(t,e){"string"==typeof t&&(e=t,t=window),e=e.split(".");for(var i;;){if(i=e.shift(),!(i in t))return!1;if(0===e.length)return!0;t=t[i]}}e.exports=i},{}],50:[function(t,e){var i,n=t("../lib/data"),o=t("./getpath"),s=function(t,e){var i=t&&t.timing&&t.timing.responseStart||Date.now();return function(){return e+(Date.now()-i)}}(window.performance,n.get("Context/time")),r={getRealNow:o("Tumblr.getRealNow"),realStartedAt:o("Tumblr.real_started_at"),startedAt:o("Tumblr.started_at")},a=function(){return i||(i=r.getRealNow?r:{getRealNow:s,realStartedAt:s(),startedAt:(new Date).getTime()}),i};e.exports=a()},{"../lib/data":30,"./getpath":48}],51:[function(t,e){function i(t,e,i){"string"==typeof t&&(i=e,e=t,t=window),e=e.split(".");for(var n,o=e.pop();e.length;)n=e.shift(),t=n in t?t[n]:t[n]={};return t[o]=i}e.exports=i},{}],52:[function(t,e){var i=t("backbone"),n=t("./mixins/accessor"),o=t("./mixins/selectorcache"),s=t("./lib/extendwithmixins"),r=i.View.extend();n.applyTo(r.prototype),o.applyTo(r.prototype),s.applyTo(r),e.exports=r},{"./lib/extendwithmixins":34,"./mixins/accessor":42,"./mixins/selectorcache":43,backbone:"5kFNoY"}],53:[function(t,e){var i=function(){function t(t,e){var i=t-this.element.width()/2,n=e-this.element.height()-10;this.element.css({left:i+"px",top:n+"px"})}function e(){var t=this.element.get(0).getBoundingClientRect().left;0>t&&this.element.css("left","+="+-1*t+"px");var e=this.element.get(0).getBoundingClientRect().top;0>e&&this.element.css("top","+="+-1*e+"px")}var i=function(t){return this.element?void(this.onShow=t||function(){}):(console.error("ControlBase requires an element"),null)};return i.prototype.hide=function(){this.element.hide(),this.isShown=!1},i.prototype.show=function(i,n){"number"==typeof i&&"number"==typeof n&&t.call(this,i,n),this.element.show(),e.call(this),this.isShown=!0,this.onShow.call(this)},i.prototype.toggle=function(t,e){this.isShown?this.hide():this.show(t,e)},i}();e.exports=i},{}],54:[function(t,e){var i=t("lodash"),n=t("jquery"),o=t("./sanitize"),s=function(){function t(t){var e=/<\S[^><]*>/g;return t.replace(e,"")}function e(t){for(var e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,function(t){return a(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},!1),o=[];e.nextNode();)o.push(e.currentNode);n(t).empty(),i.each(o,function(e){var o=i.some(e.children,function(t){return a(t)}),s=""===e.innerHTML.trim().replace(/(\r\n|\n|\r)/gm,"");o||s||n(t).append(e)})}function s(t){var e=l(t);e.shift();for(var i=e.shift();i&&!n(i).is("[contentEditable]");)n(i).contents().unwrap(),i=e.shift()}var r=["P","BLOCKQUOTE","PRE","UL","OL","DIV"],a=function(t){return i.contains(r,t.nodeName)},l=function(t){return i.filter(t,function(t){return i.contains(r,t.nodeName)})},c=function(t){this.sanitizeConfig=t};return c.prototype.flattenBlocksDown=function(t){e(t)},c.prototype.unwrapParentBlocks=function(t){s(t)},c.prototype.filterHTML=function(t){var e=document.createElement("div");e.innerHTML=t;var i=new o(this.sanitizeConfig),n=i.clean_node(e),s=document.createElement("div");s.appendChild(n.cloneNode(!0));var r=s.innerHTML,a=r.replace(/(?:\r?\n|\r)+/,"");return a=a.replace(/[<]p[>]\s*[<]\/p[>]/g,"")},c.prototype.filterPlaintext=function(e){var n=t(e);return n=i.escape(n),n=n.replace(/(?:\r?\n|\r)+/,""),n=n.replace(/\n/g,"<br>")},c}();e.exports=s},{"./sanitize":59,jquery:"HlZQrA",lodash:"K2RcUv"}],55:[function(t,e){var i=t("lodash"),n=t("jquery"),o=t("./linkControl"),s=t("./formattingControls"),r=t("./dataFilter"),a=t("./selectionPersistence"),l=t("./selectionContext"),c=function(){function t(){this.config.placeholder&&!$.call(this)?k.call(this):T.call(this,L);var t=n("<div />",{"data-js":"editor-wrapper","class":"editor-wrapper"}).css("position","relative"),o=n("<div />",{"data-js":"editor-slot","class":"editor-slot"}).css("position","relative");n(this.element).wrap(t).wrap(o),o=n(this.element).parent(),t=o.parent(),o.append(this.contextualControls.element),o.append(this.linkControl.element);var s=n("<div />",{"data-js":"control-bar","class":"control-bar"}),r=n("<div />",{"class":"static-controls control"});s.append(r),s.append(this.staticControls.element);var a=this;r.on("mousedown",function(t){t.preventDefault(),t.stopPropagation();var e=l.getNodeList();a.staticControls.setActives(i.pluck(e,"nodeName"));var o=n(this).position();return a.staticControls.toggle(o.left+n(this).width()/2,0),!1}),t.append(s),e.call(this),c.call(this)}function e(){var t=this;n(this.element).on("keydown keyup keypress mousedown mouseup",function(e){t.config.onClientEvent.call(t,e)}),n(this.element).on("keyup",function(e){N.call(t),_.call(t,e),t.onChange()});var e=!1;n(this.element).on("mouseup",function(){e=!1,_.call(t)}),n(this.element).on("mousedown",function(){e=!0}),n(this.element).on("mouseleave",function(){e&&_.call(t)});var i=n(this.element).parent().parent().get(0);document.addEventListener("click",function(e){i===e.target||n.contains(i,e.target)||(t.contextualControls.hide(),t.staticControls.hide(),t.linkControl.close())},!0),n(this.element).on("keydown",function(e){d.call(t,e)}),n(this.element).on("paste",function(e){var i=(e.originalEvent||e).clipboardData;C.call(t,i),e.preventDefault()})}function c(){var t=this,e=!1,i=n(this.element).children(A.join()),o=i.last(),s="dragenter dragleave dragover drop",r=function(e,i,o){var s=e.originalEvent.dataTransfer.files;if(s.length){var r=s[0].type;if(!/^image[/]\w*$/.test(r))return void console.warn("Sorry, you may only add image files to the editor.");var a=new FileReader;a.onload=function(e){var r=n("<img />",{src:e.target.result}).css({"max-width":"100%",margin:"0 auto"});g.call(t,r.get(0),i,o),t.config.onImageAdded.call(t,r,s[0]),t.onChange()},a.readAsDataURL(s[0])}};n(t.element).unbind(s),n(t.element).on("dragenter",function(t){t.originalEvent.dataTransfer.files.length&&!e&&(t.stopPropagation(),t.preventDefault(),n(o).addClass("over-bottom"))}),n(t.element).on("dragleave",function(){n(o).removeClass("over-bottom")}),n(t.element).on("dragover",function(t){t.originalEvent.dataTransfer.files.length&&!e&&(t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="move",n(o).addClass("over-bottom"))}),n(t.element).on("drop",function(t){t.stopPropagation(),t.preventDefault(),n(o).removeClass("over-top").removeClass("over-bottom"),r(t,o,!0)}),i.each(function(){n(this).unbind(s),n(this).on("dragenter",function(t){t.originalEvent.dataTransfer.files.length&&(e=!0,t.stopPropagation(),t.preventDefault(),n(this).addClass("over-top"),n(this).removeClass("over-bottom"))}),n(this).on("dragleave",function(){e=!1,n(this).removeClass("over-top")}),n(this).on("dragover",function(t){t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="move"}),n(this).on("drop",function(t){t.stopPropagation(),t.preventDefault(),n(this).removeClass("over-top").removeClass("over-bottom"),r(t,this,!1)})})}function u(t,e){var o=this;console.log("Running command: "+t);var s=i.bind(function(){window.document.execCommand(t),o.config.flattenBlocks&&f.call(this)},this),r=function(){o.contextualControls.hide();var t=l.getContextCoordinates(n(o.element).parent().parent()),e=a.saveSelection(o.element);o.linkControl.createOrEdit(null,e),o.linkControl.show(t.x,t.y)},c=function(t){p(["UL","OL","BLOCKQUOTE"]),window.document.execCommand("formatBlock",!1,"<"+t+">"),f.call(o)};switch(t){case"formatBlock":c(e),_.call(this);break;case"createLink":r();break;case"insertOrderedList":s(),_.call(this);break;case"insertUnorderedList":_.call(this),s();break;default:window.document.execCommand(t),_.call(this)}m(),o.onChange()}function h(t,e){switch(t){case"formatBlock":switch(e){case"blockquote":p("BLOCKQUOTE");break;default:window.document.execCommand("formatBlock",!1,"<p>")}break;case"insertOrderedList":p("OL");break;case"insertUnorderedList":p("UL");break;case"createLink":window.document.execCommand("unlink");break;default:window.document.execCommand(t)}m(),_.call(this),this.onChange()}function d(t){var e=function(){return!!l.getNearestNodeByType(["UL","OL"])};e()&&9===t.keyCode&&(t.preventDefault(),t.shiftKey?(u.call(this,"outdent"),e()||window.document.execCommand("formatBlock",!1,"<p>")):u.call(this,"indent"))}function p(t){for(window.document.execCommand("formatBlock",!1,"<p>");l.getNearestNodeByType(t);)window.document.execCommand("outdent")}function f(){var t=a.saveSelection(this.element),e=l.getCommonNode(),i=l.getParentNodes(e);this.dataFilter.unwrapParentBlocks(i),a.restoreSelection(t)}function m(){var t=l.getNearestNodeByType("SPAN");n(t).contents().unwrap()}function _(){var t=this;setTimeout(function(){var e=window.getSelection(),i=!e.isCollapsed;i?b.call(t,e):x.call(t,e),t.config.onSelection.call(t,e)},20),this.linkControl.close()}function g(t,e,i){e=e||y.call(this),i=i||!1;var o=v(t);i?(n(e).next().length||n(e).after(L),n(e).after(o)):(n(e).before(o),n(e).next().length||n(e).after(L)),window.getSelection().removeAllRanges(),this.contextualControls.hide(),(n(e).hasClass("placeholder")||e.outerHTML===L)&&n(e).remove(),n(o).prev().length||n(o).before(L)}function v(t){var e=n("<div />",{"class":"block-holder",contentEditable:!1,draggable:!0});n(t).wrap(e);var o=n(t).parent(),s=n("<div />",{"class":"block-killer"}).text("");o.append(s);var r=this;return o.click(function(){n(r.element).blur(),n(this).attr("tabindex",-1).focus(),window.getSelection().removeAllRanges()}),s.click(function(){var t=n(o).prev();i.isEmpty(n(t).text().trim())&&n(t).remove(),o.remove()}),o.on("keydown",function(t){8===t.keyCode&&o.remove(),t.preventDefault(),t.stopPropagation()}),o}function y(){var t=w();if(!t){var e=n(this.element).children(A.join());if(!e.length)return console.warn("No blocks in the editor, something is wrong..."),null;t=e.last().get(0)}return t}function w(t){return t||(t=l.getNodeList()),i.find(t,function(t){return i.contains(A,t.nodeName)})}function b(t){var e=l.getContextCoordinates(n(this.element).parent().parent()),o=l.getNodeList(t);this.contextualControls.setActives(i.pluck(o,"nodeName")),this.staticControls.setActives(i.pluck(o,"nodeName")),e&&this.contextualControls.show(e.x,e.y)}function x(t){this.contextualControls.hide();var e=l.getNodeList(t),o=i.find(e,function(t){return"A"===t.nodeName});if(this.linkControl.isValidLink(o)){var s=document.createRange();s.selectNodeContents(o),t.removeAllRanges(),t.addRange(s);var r=l.getContextCoordinates(n(this.element).parent().parent());this.linkControl.showOptions(o),this.linkControl.show(r.x,r.y)}this.staticControls.setActives(i.pluck(e,"nodeName"))}function k(){var t=j(this.config.placeholder),e=i.bind(this.isEmpty,this),o=this;T.call(this,t),n(this.element).on("focus",function(){e()&&R.call(o)}),n(this.element).on("blur",function(){e()&&T.call(o,t)})}function C(t){var e="",n=a.saveSelection(this.element);i.contains(t.types,"text/html")?(e=t.getData("text/html"),e=this.dataFilter.filterHTML(e),E.call(this,e)):(e=t.getData("text/plain"),e=this.dataFilter.filterPlaintext(e),E.call(this,e)),a.restoreSelection(n);var o=l.getCommonNode();this.dataFilter.flattenBlocksDown(o),this.onChange()}function T(t){n(this.element).html(t),this.onChange()}function $(){return n(this.element).html().trim()}function E(t){if(!t)return void console.warn("Cannot insert empty data");var e=window.getSelection();if(!n(this.element).is(":focus")||!e.focusNode)return void console.warn("Cannot insert without the editor having a cursor or selection");var i=e.getRangeAt(0);i.deleteContents();var o=i.createContextualFragment(t);i.insertNode(o)}function S(t){i.each(n(t).find("img"),function(t){v(t)})}function R(){T.call(this,L);var t=window.getSelection(),e=t.anchorNode;e&&(range=document.createRange(),range.setStart(e.childNodes[0],0),range.collapse(!0),t.removeAllRanges(),t.addRange(range))}function N(){var t=$.call(this);(""===t||"<br>"===t)&&R.call(this)}var L="<p><br></p>",A=["P","BLOCKQUOTE","PRE","UL","OL","DIV"],j=i.memoize(function(t){return'<p class="placeholder">'+t+"</p>"}),O=function(e,n){if(!e)throw new Error("A valid element parameter is required to initalize the editor");this.element=e,this.config={placeholder:!1,onChange:function(){},onSelection:function(){},onImageAdded:function(){},onClientEvent:function(){},flattenBlocks:!0,filterRules:{elements:["a","b","i","ul","ol","li","p","pre","blockquote","img"],attributes:{a:["href","title"],img:["src","alt"]},remove_contents:["style","noscript","script","meta"],protocols:{a:{href:["http","https","mailto"]}}},linkRules:{bypassClasses:[]}},i.extend(this.config,n||{}),this.linkControl=new o(this.config.linkRules),this.contextualControls=new s(i.bind(u,this),i.bind(h,this)),this.staticControls=new s(i.bind(u,this),i.bind(h,this),i.bind(_,this),function(){var t=this,e=function(){t.hide(),document.removeEventListener("click",e,!1)};document.addEventListener("mousedown",e)}),this.dataFilter=new r(this.config.filterRules),this.onChange=function(){c.call(this),this.config.onChange.call(this)},t.call(this)};return O.prototype.getData=function(){var t=$.call(this);return t===j(this.config.placeholder)&&(t=""),t},O.prototype.setData=function(t,e,i){e&&(t=this.dataFilter.filterHTML(t)),T.call(this,t),i&&this.dataFilter.flattenBlocksDown(this.element),S(this.element)},O.prototype.insertData=function(t,e,i){e&&(t=this.dataFilter.filterHTML(t)),E.call(this,t),i&&this.dataFilter.flattenBlocksDown(l.getCommonNode()),this.onChange()},O.prototype.insertBlock=function(t,e){e&&(t=this.dataFilter.filterHTML(t)),g.call(this,t)},O.prototype.addControl=function(t){var e=n(this.element).parent().parent(),i=e.find("[data-js=control-bar]");i.append(t)},O.prototype.isEmpty=function(){var t=j(this.config.placeholder),e=$.call(this);return e===L||""===e||e===t},O}();e.exports=c},{"./dataFilter":54,"./formattingControls":56,"./linkControl":58,"./selectionContext":60,"./selectionPersistence":61,jquery:"HlZQrA",lodash:"K2RcUv"}],56:[function(t,e){var i=t("lodash"),n=t("jquery"),o=t("./controlBase"),s=function(){function t(){this.element=n("<div />",{"class":"bubbles"}).css({position:"absolute",top:0,left:0}).append('<div class="bold" title="Bold" data-el="b" data-command="bold" data-type="inline">&nbsp;</div>').append('<div class="italic" title="Italic" data-el="i" data-command="italic" data-type="inline">&nbsp;</div>').append('<div class="link" title="Link" data-el="a" data-command="createLink" data-type="inline">&nbsp;</div>').append('<div class="unordered-list" title="Unordered List" data-el="ul" data-command="insertUnorderedList" data-type="list">&nbsp;</div>').append('<div class="ordered-list" title="Ordered List" data-el="ol" data-command="insertOrderedList" data-type="list">&nbsp;</div>').append('<div class="quote" title="Quote" data-el="blockquote" data-command="formatBlock" data-type="block">&nbsp;</div>').append('<div class="preformatted" title="Preformatted" data-el="pre" data-command="formatBlock" data-type="block">&nbsp;</div>'),this.buttons=n(this.element).find("div"),this.hide();var t=this;this.buttons.on("mousedown",function(i){i.preventDefault(),e.call(t,this)})}function e(t){n(t).hasClass("active")&&this.inverseCommand&&"function"==typeof this.inverseCommand?this.inverseCommand(n(t).attr("data-command"),n(t).attr("data-el")):this.applyCommand&&"function"==typeof this.applyCommand&&this.applyCommand(n(t).attr("data-command"),n(t).attr("data-el")),this.onAction()}var s=function(e,i,n,s){this.applyCommand=e,this.inverseCommand=i,this.onAction=n||function(){},t.call(this),o.call(this,s)};return i.assign(s.prototype,o.prototype),s.prototype.setActives=function(t){this.buttons.removeClass("active");var e=this.buttons.filter(function(){var e="block"===n(this).attr("data-type")&&i.contains(t,n(this).attr("data-el").toUpperCase()),o=document.queryCommandState(n(this).attr("data-command"));return o||e});e.addClass("active")},s}();e.exports=s},{"./controlBase":53,jquery:"HlZQrA",lodash:"K2RcUv"}],57:[function(t,e){var i={Editor:t("./editor"),SelectionContext:t("./selectionContext")};e.exports=i},{"./editor":55,"./selectionContext":60}],58:[function(t,e){var i=t("lodash"),n=t("jquery"),o=t("./selectionPersistence"),s=t("./controlBase"),r=function(){function t(){this.element=n("<div />",{"class":"link-bubbles"}).css({position:"absolute",top:0,left:0});var t=n("<div />",{"class":"url"}),o=n("<input />",{type:"text",placeholder:"Paste a link"}),s=n("<div />",{"class":"cancel"}).text("");s.click(i.bind(function(){this.close()},this)),t.hide(),t.append(o).append(s),e.call(this),this.element.append(t),this.hide()}function e(){var t=this,e=n("<div />",{"class":"options"}),i={edit:function(){this.createOrEdit(this.linkElement)},remove:function(){var t=window.getSelection(),e=document.createRange();e.selectNodeContents(this.linkElement),t.removeAllRanges(),t.addRange(e),window.document.execCommand("unlink",!1,null),t.removeAllRanges(),this.hide()},open:function(){window.open(n(this.linkElement).attr("href"),"_blank")}};for(var o in i){var s=n("<div />",{"class":o}).text(o);n(s).on("click",function(e){return function(){e.call(t)}}(i[o])),e.append(s)}e.hide(),n(this.element).append(e)}var r=function(e){this.onLinkEntered="onLinkEntered"in e&&i.isFunction(e.onLinkEntered)?e.onLinkEntered:i.noop,this.bypassClasses="bypassClasses"in e&&i.isArray(e.bypassClasses)?e.bypassClasses:[],this.linkElement=null,t.call(this),s.call(this)};return i.assign(r.prototype,s.prototype),r.prototype.createOrEdit=function(t,e){var i=this.element.find("input");t&&(this.linkElement=t,i.val(n(this.linkElement).attr("href"))),this.element.find(".options").hide(),this.element.find(".url").show(),this.show();var s=this;n(i).on("keydown",function(t){if(13===t.keyCode){t.preventDefault();var i=n(this).val(),r=window.getSelection();if(e)o.restoreSelection(e);else{var a=document.createRange();a.selectNodeContents(this.linkElement),r.removeAllRanges(),r.addRange(a)}window.document.execCommand("createLink",!1,i),r.removeAllRanges(),s.close()}})},r.prototype.showOptions=function(t){this.linkElement=t,this.element.find(".url").hide(),this.element.find(".options").show()},r.prototype.close=function(){this.element.find(".url").hide(),this.element.find(".options").hide(),this.element.find("input").val("").unbind(),this.linkElement=null,this.hide()
},r.prototype.isValidLink=function(t){return t?!i.some(this.bypassClasses,function(e){return n(t).hasClass(e)}):!1},r}();e.exports=r},{"./controlBase":53,"./selectionPersistence":61,jquery:"HlZQrA",lodash:"K2RcUv"}],59:[function(t,e){function i(){var t,e;for(e=arguments[0]||{},this.config={},this.config.elements=e.elements?e.elements:[],this.config.attributes=e.attributes?e.attributes:{},this.config.attributes[i.ALL]=this.config.attributes[i.ALL]?this.config.attributes[i.ALL]:[],this.config.allow_comments=e.allow_comments?e.allow_comments:!1,this.allowed_elements={},this.config.protocols=e.protocols?e.protocols:{},this.config.add_attributes=e.add_attributes?e.add_attributes:{},this.dom=e.dom?e.dom:document,t=0;t<this.config.elements.length;t++)this.allowed_elements[this.config.elements[t]]=!0;if(this.config.remove_element_contents={},this.config.remove_all_contents=!1,e.remove_contents)if(e.remove_contents instanceof Array)for(t=0;t<e.remove_contents.length;t++)this.config.remove_element_contents[e.remove_contents[t]]=!0;else this.config.remove_all_contents=!0;this.transformers=e.transformers?e.transformers:[]}i.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i,i.RELATIVE="__RELATIVE__",i.ALL="__ALL__",i.prototype.clean_node=function(t){function e(t,e){var i;for(i=0;i<e.length;i++)if(e[i]===t)return i;return-1}function n(){var t,e,i=[],n={};for(t=0;t<arguments.length;t++)if(arguments[t]&&arguments[t].length)for(e=0;e<arguments[t].length;e++)n[arguments[t][e]]||(n[arguments[t][e]]=!0,i.push(arguments[t][e]));return i}function o(t){var e;switch(t.nodeType){case 1:s.call(this,t);break;case 3:e=t.cloneNode(!1),this.current_element.appendChild(e);break;case 5:e=t.cloneNode(!1),this.current_element.appendChild(e);break;case 8:this.config.allow_comments&&(e=t.cloneNode(!1),this.current_element.appendChild(e));break;default:console&&console.log&&console.log("unknown node type",t.nodeType)}}function s(t){var s,a,l,c,u,h,d,p,f,m,_=r.call(this,t);if(t=_.node,l=t.nodeName.toLowerCase(),a=this.current_element,this.allowed_elements[l]||_.whitelist){this.current_element=this.dom.createElement(t.nodeName),a.appendChild(this.current_element);var g=this.config.attributes;for(c=n(g[l],g[i.ALL],_.attr_whitelist),s=0;s<c.length;s++)h=c[s],u=t.attributes[h],u&&(m=!0,this.config.protocols[l]&&this.config.protocols[l][h]&&(p=this.config.protocols[l][h],f=u.nodeValue.toLowerCase().match(i.REGEX_PROTOCOL),m=f?-1!==e(f[1],p):-1!==e(i.RELATIVE,p)),m&&(d=document.createAttribute(h),d.value=u.nodeValue,this.current_element.setAttributeNode(d)));if(this.config.add_attributes[l])for(h in this.config.add_attributes[l])d=document.createAttribute(h),d.value=this.config.add_attributes[l][h],this.current_element.setAttributeNode(d)}else if(-1!==e(t,this.whitelist_nodes)){for(this.current_element=t.cloneNode(!0);this.current_element.childNodes.length>0;)this.current_element.removeChild(this.current_element.firstChild);a.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[l])for(s=0;s<t.childNodes.length;s++)o.call(this,t.childNodes[s]);this.current_element.normalize&&this.current_element.normalize(),this.current_element=a}function r(t){var i,o,s,r={attr_whitelist:[],node:t,whitelist:!1};for(i=0;i<this.transformers.length;i++)if(s=this.transformers[i]({allowed_elements:this.allowed_elements,config:this.config,node:t,node_name:t.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom}),null!==s){if("object"!=typeof s)throw new Error("transformer output must be an object or null");if(s.whitelist_nodes&&s.whitelist_nodes instanceof Array)for(o=0;o<s.whitelist_nodes.length;o++)-1===e(s.whitelist_nodes[o],this.whitelist_nodes)&&this.whitelist_nodes.push(s.whitelist_nodes[o]);r.whitelist=s.whitelist?!0:!1,s.attr_whitelist&&(r.attr_whitelist=n(r.attr_whitelist,s.attr_whitelist)),r.node=s.node?s.node:r.node}return r}var a=this.dom.createDocumentFragment();this.current_element=a,this.whitelist_nodes=[];for(var l=0;l<t.childNodes.length;l++)o.call(this,t.childNodes[l]);return a.normalize&&a.normalize(),a},e.exports=i},{}],60:[function(t,e){var i=t("lodash"),n=t("jquery"),o=function(){var t={getCommonNode:function(e){if(e=e||t.getSelection(),!e)return null;var i=e.getRangeAt(0);return i.commonAncestorContainer},getParentNodes:function(e,i){return i=i||[],n(e).is("[contentEditable]")?i:e?(i.push(e),t.getParentNodes(e.parentNode,i)):null},getNodeList:function(e){e=e||t.getSelection();var i=e&&e.anchorNode?e.anchorNode.parentNode:null;return i?t.getParentNodes(i):[]},getNearestNodeByType:function(e,n){var o=[].concat(e);return n||(n=t.getNodeList()),i.find(n,function(t){return i.contains(o,t.nodeName)})},getContextCoordinates:function(e){var i=t.getSelection(),o=i.getRangeAt(0).cloneRange();if(!i.isCollapsed){var s=o.getBoundingClientRect(),r=n(e).offset();return{x:s.left+s.width/2-r.left,y:s.top-r.top+n(window).scrollTop()}}if(o.getClientRects){o.collapse(!0);var a=o.getClientRects()[0];if(a){var l=a.left,c=a.top;return{x:l,y:c}}}},getSelection:function(){var t=window.getSelection();if(t.anchorNode){var e=n(t.anchorNode).closest("[contenteditable]").length;return e?t:null}return null}};return t}();e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],61:[function(t,e){var i=function(){var t,e;return window.getSelection&&document.createRange?(t=function(t){var e=window.getSelection().getRangeAt(0),i=e.cloneRange();i.selectNodeContents(t),i.setEnd(e.startContainer,e.startOffset);var n=i.toString().length;return{container:t,start:n,end:n+e.toString().length}},e=function(t){var e=0,i=document.createRange();i.setStart(t.container,0),i.collapse(!0);for(var n,o=[t.container],s=!1,r=!1;!r&&(n=o.pop());)if(3===n.nodeType){var a=e+n.length;!s&&t.start>=e&&t.start<=a&&(i.setStart(n,t.start-e),s=!0),s&&t.end>=e&&t.end<=a&&(i.setEnd(n,t.end-e),r=!0),e=a}else for(var l=n.childNodes.length;l--;)o.push(n.childNodes[l]);var c=window.getSelection();c.removeAllRanges(),c.addRange(i)}):document.selection&&(t=function(t){var e=document.selection.createRange(),i=document.body.createTextRange();i.moveToElementText(t),i.setEndPoint("EndToStart",e);var n=i.text.length;return{container:t,start:n,end:n+e.text.length}},e=function(t){var e=document.body.createTextRange();e.moveToElementText(t.container),e.collapse(!0),e.moveEnd("character",t.end),e.moveStart("character",t.start),e.select()}),{saveSelection:t,restoreSelection:e}}();e.exports=i},{}]},{},[]);